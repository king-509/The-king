<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Recherche & Modification | Ralph Xpert</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background-color: #0D1117;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      color: #E6EDF3;
      line-height: 1.5;
      min-height: 100vh;
      font-size: 13px;
      padding: 20px 10px;
    }

    .container {
      background-color: #161B22;
      color: #E6EDF3;
      padding: 25px 20px;
      border-radius: 14px;
      margin: 20px auto;
      text-align: center;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
      max-width: 600px;
      border: 1px solid #30363D;
    }

    h1 {
      color: #2FD771;
      font-weight: 700;
      font-size: 2rem;
      margin-bottom: 12px;
      text-shadow: 0 2px 6px rgba(47, 215, 113, 0.3);
    }

    p {
      font-size: 0.9rem;
      line-height: 1.4;
      color: #C9D1D9;
      margin-bottom: 20px;
      font-weight: 400;
    }

    .search-section {
      margin-bottom: 30px;
    }

    .search-box {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .search-box input {
      flex: 1;
      padding: 10px 14px;
      border-radius: 8px;
      border: 2px solid #30363D;
      font-size: 0.85rem;
      background: #21262D;
      color: #E6EDF3;
      transition: all 0.3s ease;
      font-family: 'Inter', sans-serif;
    }

    .search-box input:focus {
      outline: none;
      border-color: #2FD771;
      box-shadow: 0 0 0 3px rgba(47, 215, 113, 0.2);
      background: #161B22;
    }

    .search-btn {
      background: linear-gradient(135deg, #2FD771, #26C65A);
      color: #0D1117;
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      font-size: 0.85rem;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    .search-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 15px rgba(47, 215, 113, 0.4);
    }

    .search-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .results-container {
      background: #0D1117;
      border-radius: 10px;
      padding: 15px;
      border: 1px solid #30363D;
      margin-top: 20px;
      display: none;
    }

    .contact-item {
      background: #161B22;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 10px;
      border-left: 3px solid #2FD771;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s ease;
    }

    .contact-item:hover {
      transform: translateX(2px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    .contact-info {
      flex: 1;
      text-align: left;
    }

    .contact-info h3 {
      color: #2FD771;
      font-size: 0.9rem;
      margin-bottom: 3px;
      font-weight: 600;
    }

    .contact-info p {
      color: #C9D1D9;
      font-size: 0.8rem;
      margin: 0;
    }

    .contact-actions {
      display: flex;
      gap: 8px;
    }

    .action-btn {
      padding: 6px 10px;
      border: none;
      border-radius: 6px;
      font-size: 0.7rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-edit {
      background: #3498db;
      color: white;
    }

    .btn-delete {
      background: #e74c3c;
      color: white;
    }

    .action-btn:hover {
      transform: translateY(-1px);
      opacity: 0.9;
    }

    .back-btn {
      background: linear-gradient(135deg, #21262D, #30363D);
      color: #E6EDF3;
      padding: 10px 16px;
      border: 2px solid #30363D;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
      font-size: 0.85rem;
      transition: all 0.3s ease;
      display: inline-block;
      margin-top: 20px;
    }

    .back-btn:hover {
      background: linear-gradient(135deg, #2FD771, #26C65A);
      color: #0D1117;
      transform: translateY(-1px);
    }

    .success-message, .error-message {
      padding: 10px 15px;
      border-radius: 8px;
      margin: 15px 0;
      font-weight: 600;
      font-size: 0.85rem;
      display: none;
    }

    .success-message {
      background: linear-gradient(135deg, #2FD771, #26C65A);
      color: #0D1117;
    }

    .error-message {
      background: linear-gradient(135deg, #e74c3c, #c0392b);
      color: white;
    }

    .no-results {
      text-align: center;
      color: #7D8590;
      padding: 20px;
      font-size: 0.9rem;
    }

    /* Modal pour modification */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      backdrop-filter: blur(5px);
    }

    .modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #161B22;
      border-radius: 14px;
      border: 1px solid #30363D;
      padding: 25px;
      max-width: 450px;
      width: 90%;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .modal-header h3 {
      color: #2FD771;
      font-size: 1.2rem;
      font-weight: 700;
    }

    .close-btn {
      background: none;
      border: none;
      color: #7D8590;
      font-size: 1.5rem;
      cursor: pointer;
      transition: color 0.3s ease;
    }

    .close-btn:hover {
      color: #e74c3c;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      color: #2FD771;
      font-weight: 600;
      margin-bottom: 5px;
      font-size: 0.85rem;
    }

    .form-group input, .form-group select {
      width: 100%;
      padding: 10px 12px;
      border: 2px solid #30363D;
      border-radius: 8px;
      background: #21262D;
      color: #E6EDF3;
      font-size: 0.85rem;
      font-family: 'Inter', sans-serif;
      transition: all 0.3s ease;
    }

    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: #2FD771;
      box-shadow: 0 0 0 3px rgba(47, 215, 113, 0.2);
      background: #161B22;
    }

    .modal-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 20px;
    }

    .modal-btn {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-save {
      background: linear-gradient(135deg, #2FD771, #26C65A);
      color: #0D1117;
    }

    .btn-cancel {
      background: #7D8590;
      color: white;
    }

    .modal-btn:hover {
      transform: translateY(-1px);
      opacity: 0.9;
    }

    @media (max-width: 768px) {
      .container {
        margin: 10px;
        padding: 20px 15px;
      }

      h1 {
        font-size: 1.8rem;
      }

      .search-box {
        flex-direction: column;
      }

      .contact-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .contact-actions {
        align-self: flex-end;
      }
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>🔍 Recherche & Modification</h1>
    <p>
      Recherchez votre contact par nom ou numéro de téléphone pour le modifier ou le supprimer.
    </p>

    <div id="successMessage" class="success-message"></div>
    <div id="errorMessage" class="error-message"></div>

    <div class="search-section">
      <div class="search-box">
        <input 
          type="text" 
          id="searchInput" 
          placeholder="Tapez votre nom ou numéro de téléphone..." 
          onkeyup="handleSearchKeyup(event)"
        />
        <button class="search-btn" id="searchBtn" onclick="rechercherContact()">
          🔍 Rechercher
        </button>
      </div>
    </div>

    <div id="resultsContainer" class="results-container">
      <div id="resultsList"></div>
    </div>

    <a href="index.html" class="back-btn">← Retour à l'accueil</a>
  </div>

  <!-- Modal de modification -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>✏️ Modifier le Contact</h3>
        <button class="close-btn" onclick="closeEditModal()">&times;</button>
      </div>
      
      <form id="editForm">
        <div class="form-group">
          <label for="editNom">Nom complet</label>
          <input type="text" id="editNom" required />
        </div>

        <div class="form-group">
          <label for="editCodePays">Code pays</label>
          <select id="editCodePays" required>
            <option value="+509">🇭🇹 Haïti (+509)</option>
            <option value="+1">🇨🇦 Canada (+1)</option>
            <option value="+1">🇺🇸 États-Unis (+1)</option>
            <option value="+33">🇫🇷 France (+33)</option>
            <option value="+49">🇩🇪 Allemagne (+49)</option>
            <option value="+44">🇬🇧 Royaume-Uni (+44)</option>
            <option value="+39">🇮🇹 Italie (+39)</option>
            <option value="+34">🇪🇸 Espagne (+34)</option>
            <option value="+86">🇨🇳 Chine (+86)</option>
            <option value="+81">🇯🇵 Japon (+81)</option>
            <option value="+91">🇮🇳 Inde (+91)</option>
            <option value="+55">🇧🇷 Brésil (+55)</option>
            <option value="+52">🇲🇽 Mexique (+52)</option>
            <option value="+61">🇦🇺 Australie (+61)</option>
            <option value="+7">🇷🇺 Russie (+7)</option>
            <option value="+82">🇰🇷 Corée du Sud (+82)</option>
            <option value="+27">🇿🇦 Afrique du Sud (+27)</option>
            <option value="+20">🇪🇬 Égypte (+20)</option>
            <option value="+234">🇳🇬 Nigéria (+234)</option>
            <option value="+254">🇰🇪 Kenya (+254)</option>
            <option value="+212">🇲🇦 Maroc (+212)</option>
            <option value="+213">🇩🇿 Algérie (+213)</option>
            <option value="+216">🇹🇳 Tunisie (+216)</option>
            <option value="+221">🇸🇳 Sénégal (+221)</option>
            <option value="+225">🇨🇮 Côte d'Ivoire (+225)</option>
            <option value="+237">🇨🇲 Cameroun (+237)</option>
            <option value="+241">🇬🇦 Gabon (+241)</option>
            <option value="+243">🇨🇩 RD Congo (+243)</option>
            <option value="+250">🇷🇼 Rwanda (+250)</option>
            <option value="+256">🇺🇬 Ouganda (+256)</option>
            <option value="+255">🇹🇿 Tanzanie (+255)</option>
            <option value="+260">🇿🇲 Zambie (+260)</option>
            <option value="+263">🇿🇼 Zimbabwe (+263)</option>
            <option value="+265">🇲🇼 Malawi (+265)</option>
            <option value="+267">🇧🇼 Botswana (+267)</option>
            <option value="+268">🇸🇿 Eswatini (+268)</option>
            <option value="+266">🇱🇸 Lesotho (+266)</option>
            <option value="+230">🇲🇺 Maurice (+230)</option>
            <option value="+248">🇸🇨 Seychelles (+248)</option>
            <option value="+261">🇲🇬 Madagascar (+261)</option>
            <option value="+269">🇰🇲 Comores (+269)</option>
          </select>
        </div>

        <div class="form-group">
          <label for="editNumero">Numéro</label>
          <input type="tel" id="editNumero" required />
        </div>

        <div class="modal-actions">
          <button type="button" class="modal-btn btn-cancel" onclick="closeEditModal()">
            Annuler
          </button>
          <button type="submit" class="modal-btn btn-save" id="saveBtn">
            💾 Sauvegarder
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Configuration API
    const API_BASE = window.location.origin;
    let currentEditingContact = null;

    // Recherche avec Enter
    function handleSearchKeyup(event) {
      if (event.key === 'Enter') {
        rechercherContact();
      }
    }

    // Rechercher un contact
    async function rechercherContact() {
      const searchTerm = document.getElementById('searchInput').value.trim();
      const searchBtn = document.getElementById('searchBtn');
      const resultsContainer = document.getElementById('resultsContainer');
      const resultsList = document.getElementById('resultsList');

      if (!searchTerm) {
        showError('Veuillez entrer un nom ou un numéro à rechercher');
        return;
      }

      // Désactiver le bouton et afficher le loading
      searchBtn.disabled = true;
      searchBtn.textContent = '⏳ Recherche...';
      hideMessages();

      try {
        // Simuler une recherche dans les contacts récents (en attendant l'API de recherche)
        const response = await fetch(`${API_BASE}/api/contacts/recent`);
        const data = await response.json();

        if (data.success) {
          // Filtrer les résultats localement
          const filteredContacts = data.contacts.filter(contact => 
            contact.nom.toLowerCase().includes(searchTerm.toLowerCase()) ||
            contact.numeroComplet.includes(searchTerm)
          );

          displayResults(filteredContacts);
          resultsContainer.style.display = 'block';
        } else {
          showError('Erreur lors de la recherche');
        }

      } catch (error) {
        console.error('Erreur recherche:', error);
        showError('Erreur de connexion lors de la recherche');
      } finally {
        // Réactiver le bouton
        searchBtn.disabled = false;
        searchBtn.textContent = '🔍 Rechercher';
      }
    }

    // Afficher les résultats
    function displayResults(contacts) {
      const resultsList = document.getElementById('resultsList');

      if (contacts.length === 0) {
        resultsList.innerHTML = `
          <div class="no-results">
            <p>😔 Aucun contact trouvé</p>
            <p>Vérifiez l'orthographe ou essayez avec un autre terme</p>
          </div>
        `;
        return;
      }

      resultsList.innerHTML = contacts.map((contact, index) => `
        <div class="contact-item">
          <div class="contact-info">
            <h3>${contact.nom}</h3>
            <p>📞 ${contact.numeroComplet}</p>
          </div>
          <div class="contact-actions">
            <button class="action-btn btn-edit" onclick="editContact(${index}, '${contact.nom}', '${contact.numeroComplet}')">
              ✏️ Modifier
            </button>
            <button class="action-btn btn-delete" onclick="deleteContact('${contact.numeroComplet}', '${contact.nom}')">
              🗑️ Supprimer
            </button>
          </div>
        </div>
      `).join('');
    }

    // Modifier un contact
    function editContact(index, nom, numeroComplet) {
      currentEditingContact = { index, nom, numeroComplet };
      
      // Séparer le code pays et le numéro
      const parts = numeroComplet.split(' ');
      const codePays = parts[0];
      const numero = parts.slice(1).join(' ');

      // Remplir le formulaire
      document.getElementById('editNom').value = nom.replace(' (RXP)', '');
      document.getElementById('editCodePays').value = codePays;
      document.getElementById('editNumero').value = numero;

      // Afficher la modal
      document.getElementById('editModal').style.display = 'block';
    }

    // Fermer la modal de modification
    function closeEditModal() {
      document.getElementById('editModal').style.display = 'none';
      currentEditingContact = null;
    }

    // Sauvegarder les modifications
    document.getElementById('editForm').addEventListener('submit', async function(event) {
      event.preventDefault();

      const nom = document.getElementById('editNom').value.trim();
      const codePays = document.getElementById('editCodePays').value;
      const numero = document.getElementById('editNumero').value.trim();
      const saveBtn = document.getElementById('saveBtn');

      if (!nom || !codePays || !numero) {
        showError('Veuillez remplir tous les champs');
        return;
      }

      // Désactiver le bouton
      saveBtn.disabled = true;
      saveBtn.textContent = '⏳ Sauvegarde...';

      try {
        // Simuler la modification (à implémenter côté serveur)
        await new Promise(resolve => setTimeout(resolve, 1000));

        showSuccess('✅ Contact modifié avec succès !');
        closeEditModal();
        
        // Relancer la recherche pour actualiser les résultats
        setTimeout(() => {
          rechercherContact();
        }, 1000);

      } catch (error) {
        console.error('Erreur modification:', error);
        showError('Erreur lors de la modification');
      } finally {
        saveBtn.disabled = false;
        saveBtn.textContent = '💾 Sauvegarder';
      }
    });

    // Supprimer un contact
    async function deleteContact(numeroComplet, nom) {
      if (!confirm(`Êtes-vous sûr de vouloir supprimer le contact "${nom}" ?`)) {
        return;
      }

      try {
        // Simuler la suppression (à implémenter côté serveur)
        await new Promise(resolve => setTimeout(resolve, 500));

        showSuccess('✅ Contact supprimé avec succès !');
        
        // Relancer la recherche pour actualiser les résultats
        setTimeout(() => {
          rechercherContact();
        }, 1000);

      } catch (error) {
        console.error('Erreur suppression:', error);
        showError('Erreur lors de la suppression');
      }
    }

    // Fonctions utilitaires pour les messages
    function showSuccess(message) {
      const successEl = document.getElementById('successMessage');
      successEl.textContent = message;
      successEl.style.display = 'block';
      
      setTimeout(() => {
        successEl.style.display = 'none';
      }, 5000);
    }

    function showError(message) {
      const errorEl = document.getElementById('errorMessage');
      errorEl.textContent = message;
      errorEl.style.display = 'block';
      
      setTimeout(() => {
        errorEl.style.display = 'none';
      }, 5000);
    }

    function hideMessages() {
      document.getElementById('successMessage').style.display = 'none';
      document.getElementById('errorMessage').style.display = 'none';
    }

    // Fermer la modal en cliquant à l'extérieur
    window.onclick = function(event) {
      const modal = document.getElementById('editModal');
      if (event.target === modal) {
        closeEditModal();
      }
    }
  </script>

</body>
</html>
